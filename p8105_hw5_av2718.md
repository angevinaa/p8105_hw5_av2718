p8105_hw5_av2718
================
Angelica Vina Albarracin
2022-11-16

Problem 2

``` r
#Load data raw data
homicide_raw = read_csv("data/homicide-data.csv") %>% 
  janitor::clean_names()

#Visualize first 8 rows
head(homicide_raw, 8) # view first 8 rows of raw data
## # A tibble: 8 × 12
##   uid    repor…¹ victi…² victi…³ victi…⁴ victi…⁵ victi…⁶ city  state   lat   lon
##   <chr>    <dbl> <chr>   <chr>   <chr>   <chr>   <chr>   <chr> <chr> <dbl> <dbl>
## 1 Alb-0…  2.01e7 GARCIA  JUAN    Hispan… 78      Male    Albu… NM     35.1 -107.
## 2 Alb-0…  2.01e7 MONTOYA CAMERON Hispan… 17      Male    Albu… NM     35.1 -107.
## 3 Alb-0…  2.01e7 SATTER… VIVIANA White   15      Female  Albu… NM     35.1 -107.
## 4 Alb-0…  2.01e7 MENDIO… CARLOS  Hispan… 32      Male    Albu… NM     35.1 -107.
## 5 Alb-0…  2.01e7 MULA    VIVIAN  White   72      Female  Albu… NM     35.1 -107.
## 6 Alb-0…  2.01e7 BOOK    GERALD… White   91      Female  Albu… NM     35.2 -107.
## 7 Alb-0…  2.01e7 MALDON… DAVID   Hispan… 52      Male    Albu… NM     35.1 -107.
## 8 Alb-0…  2.01e7 MALDON… CONNIE  Hispan… 52      Female  Albu… NM     35.1 -107.
## # … with 1 more variable: disposition <chr>, and abbreviated variable names
## #   ¹​reported_date, ²​victim_last, ³​victim_first, ⁴​victim_race, ⁵​victim_age,
## #   ⁶​victim_sex
```

This problem focuses on the `Homicide-data.csv` that The Washington Post
gathered in 50 large U.S. cities and made available through GitHub. The
raw data comprises 52179, 12observations. The data included the
geographical location of the homicide, whether an arrest was made, and,
in most cases, basic demographic information about each victim. In
total, the dataset contains 12 variables: city, disposition, lat, lon,
reported_date, state, uid, victim_age, victim_first, victim_last,
victim_race, victim_sex. Interestingly, the first and last names of the
victims are included in the data, as well as the exact location of the
homicide (lat and log).

In the code chunk below, we create a `city_state variable` (e.g.,
“Baltimore, MD”) and then summarize within cities to obtain the number
of homicides and the number of unsolved homicides per city (“Closed
without arrest” or “Open/No arrest”). Then, we calculate the total
number of homicides per city by adding a new column to the resulting
dataset.

``` r
#Clean and arrange raw variables

homicide_clean = homicide_raw %>% 
  mutate(.data = ., city_state = str_c(city, ", " ,state)) %>% 
  select(-city, -state) %>% 
  mutate(
    disposition = if_else(disposition %in% c("Closed without arrest", "Open/No arrest"), "unsolved_homicides", "homicides") 
  )

# Create new dataset with homicides and unsolved homicides summarized by city_sate

homicide_cities = homicide_clean %>% 
  group_by(city_state, disposition) %>% 
  summarize(n_obs = n())  

homicide_cities = pivot_wider(
  homicide_cities,
  names_from = "disposition",
  values_from = "n_obs") 
homicide_cities[is.na(homicide_cities)]<- 0 #Change NA values to 0

#Add column with total number of homicides

homicide_cities = 
  mutate(homicide_cities,
  total_homicides = homicides + unsolved_homicides)

#Visualize first 8 rows of new dataframe

head(homicide_cities, 8) # view first 8 rows of tidied data
## # A tibble: 8 × 4
## # Groups:   city_state [8]
##   city_state      homicides unsolved_homicides total_homicides
##   <chr>               <int>              <int>           <int>
## 1 Albuquerque, NM       232                146             378
## 2 Atlanta, GA           600                373             973
## 3 Baltimore, MD        1002               1825            2827
## 4 Baton Rouge, LA       228                196             424
## 5 Birmingham, AL        453                347             800
## 6 Boston, MA            304                310             614
## 7 Buffalo, NY           202                319             521
## 8 Charlotte, NC         481                206             687
```

For the city of Baltimore, MD, in the code chunk below, we use the
`propw.test` function to estimate the proportion of unsolved homicides.
Then and apply the `broom::tidy` function from the broom package to
constructs a `tibble` that summarizes the findings.

``` r
#Filter Baltimore data

baltimore_homicides = homicide_cities %>% 
  filter(city_state == "Baltimore, MD") 

#Prop.test

prop_test = prop.test(
  x = pull(baltimore_homicides , unsolved_homicides),
  n = pull(baltimore_homicides, total_homicides)) %>% 
  broom::tidy() %>% 
  select(estimate, conf.low, conf.high)

prop_test
## # A tibble: 1 × 3
##   estimate conf.low conf.high
##      <dbl>    <dbl>     <dbl>
## 1    0.646    0.628     0.663
```

*Proportion of homicides in Baltimore:* As reported above, the estimate
proportion of unsolved homicides in Baltimore city is 0.6455607, with a
confidence interval between 0.6275625 and 0.6631599.

Lastly, we run a `prop.test` for each city and extract the proportion of
unsolved homicides and the confidence interval for each. To do this, we
create a \`func_prop.test’ that we then apply to the entire data frame.

``` r
#Create prop.test function

func_prop.test = function(homicide_cities){
  prop_test_cities = prop.test(
    x = pull(homicide_cities , unsolved_homicides),
    n = pull(homicide_cities, total_homicides)) %>% 
    broom::tidy() %>% 
    select(estimate, conf.low, conf.high)

prop_test_cities
}

#Extract proportion of unsolved homicides and CIs for each city

prop_homicides = homicide_cities %>% 
  nest(data = unsolved_homicides:total_homicides) %>% 
  mutate(results = map(data, func_prop.test)) %>% 
  select(city_state, results) %>% 
  unnest(cols = results) 
## Warning in prop.test(x = pull(homicide_cities, unsolved_homicides), n =
## pull(homicide_cities, : Chi-squared approximation may be incorrect

#Visualize first 3 rows of results

head(prop_homicides, 3) # view first 8 rows of tidied data
## # A tibble: 3 × 4
## # Groups:   city_state [3]
##   city_state      estimate conf.low conf.high
##   <chr>              <dbl>    <dbl>     <dbl>
## 1 Albuquerque, NM    0.386    0.337     0.438
## 2 Atlanta, GA        0.383    0.353     0.415
## 3 Baltimore, MD      0.646    0.628     0.663
```

#### Proportion of Unsolved Homicides in US cities

In the code chunk below, we use our new `prop_homicides` data frame to
visualize the proportion of unsolved homicides in each US city. The plot
shows that Chicago has the largest proportion of unsolved homicides
among US cities, followed by Baltimore and New Orleans.

``` r

plot_homicides = prop_homicides %>% 
  select(city_state, estimate, conf.low, conf.high) %>%
  mutate(city_state = fct_reorder(city_state, estimate)) %>% #reorder cities according to proportion of homicides
  ggplot(aes( y = estimate, x = city_state)) +
  geom_point(color = 4) +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) + # add error bars based on CIs 
  labs(title = "Proportion of Unsolved Homicides in US Cities", 
         x = "US Cities", 
         y = "Proportion of Unsolved Homicides")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  theme(axis.text.y = element_text(size = 6)) +
  theme(plot.title = element_text(hjust = 0)) +
  theme(axis.ticks = element_blank()) +
  theme(axis.text = element_text(size = 7)) +
  theme(legend.title = element_text(size = 8)) +
  theme(legend.text = element_text(size = 6)) +
  theme(plot.title = element_text(hjust = 0.5))

  plot_homicides
```

![](p8105_hw5_av2718_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

``` r
  
  
ggsave("Homicides_US.Cities.png", plot = last_plot())
       
```

\`\`\`
